
#include "sinelut.h"
#include "tonegen.h"
#include "math.h"

extern const float sine_lut[];

float sin_aft(float amp, float freq, uint16_t t)   
{
  float w, a;
  float calc;
  float interpValue, delta;
  uint16_t n;

  // angular freq in radians
  w = TWO_PI * freq * t / DAC_SAMPLE_PER_SECOND;
  // check for wrap of 2pi
  if( w > TWO_PI )
  {
    w = w - TWO_PI * floor(w / TWO_PI);
  }
  // fractional part of 2pi
  w = w/TWO_PI * LUT_SIZE;
  // calculate base offset value
  n = floor(w);
  // delta for interpolation
  delta = w - n;
  interpValue = sine_lut[n] + delta * ( sine_lut[n+1] - sine_lut[n] );
  interpValue = interpValue * amp;
  
  return(interpValue);
}

const float sine_lut[LUT_SIZE] =
{
  0,
  0.024541229,
  0.049067674,
  0.073564564,
  0.09801714,
  0.122410675,
  0.146730474,
  0.170961889,
  0.195090322,
  0.21910124,
  0.24298018,
  0.266712757,
  0.290284677,
  0.31368174,
  0.336889853,
  0.359895037,
  0.382683432,
  0.405241314,
  0.427555093,
  0.44961133,
  0.471396737,
  0.492898192,
  0.514102744,
  0.53499762,
  0.555570233,
  0.575808191,
  0.595699304,
  0.615231591,
  0.634393284,
  0.653172843,
  0.671558955,
  0.689540545,
  0.707106781,
  0.724247083,
  0.740951125,
  0.757208847,
  0.773010453,
  0.788346428,
  0.803207531,
  0.817584813,
  0.831469612,
  0.844853565,
  0.85772861,
  0.870086991,
  0.881921264,
  0.893224301,
  0.903989293,
  0.914209756,
  0.923879533,
  0.932992799,
  0.941544065,
  0.949528181,
  0.956940336,
  0.963776066,
  0.970031253,
  0.97570213,
  0.98078528,
  0.985277642,
  0.98917651,
  0.992479535,
  0.995184727,
  0.997290457,
  0.998795456,
  0.999698819,
  1,
  0.999698819,
  0.998795456,
  0.997290457,
  0.995184727,
  0.992479535,
  0.98917651,
  0.985277642,
  0.98078528,
  0.97570213,
  0.970031253,
  0.963776066,
  0.956940336,
  0.949528181,
  0.941544065,
  0.932992799,
  0.923879533,
  0.914209756,
  0.903989293,
  0.893224301,
  0.881921264,
  0.870086991,
  0.85772861,
  0.844853565,
  0.831469612,
  0.817584813,
  0.803207531,
  0.788346428,
  0.773010453,
  0.757208847,
  0.740951125,
  0.724247083,
  0.707106781,
  0.689540545,
  0.671558955,
  0.653172843,
  0.634393284,
  0.615231591,
  0.595699304,
  0.575808191,
  0.555570233,
  0.53499762,
  0.514102744,
  0.492898192,
  0.471396737,
  0.44961133,
  0.427555093,
  0.405241314,
  0.382683432,
  0.359895037,
  0.336889853,
  0.31368174,
  0.290284677,
  0.266712757,
  0.24298018,
  0.21910124,
  0.195090322,
  0.170961889,
  0.146730474,
  0.122410675,
  0.09801714,
  0.073564564,
  0.049067674,
  0.024541229,
  1.22515E-16,
  -0.024541229,
  -0.049067674,
  -0.073564564,
  -0.09801714,
  -0.122410675,
  -0.146730474,
  -0.170961889,
  -0.195090322,
  -0.21910124,
  -0.24298018,
  -0.266712757,
  -0.290284677,
  -0.31368174,
  -0.336889853,
  -0.359895037,
  -0.382683432,
  -0.405241314,
  -0.427555093,
  -0.44961133,
  -0.471396737,
  -0.492898192,
  -0.514102744,
  -0.53499762,
  -0.555570233,
  -0.575808191,
  -0.595699304,
  -0.615231591,
  -0.634393284,
  -0.653172843,
  -0.671558955,
  -0.689540545,
  -0.707106781,
  -0.724247083,
  -0.740951125,
  -0.757208847,
  -0.773010453,
  -0.788346428,
  -0.803207531,
  -0.817584813,
  -0.831469612,
  -0.844853565,
  -0.85772861,
  -0.870086991,
  -0.881921264,
  -0.893224301,
  -0.903989293,
  -0.914209756,
  -0.923879533,
  -0.932992799,
  -0.941544065,
  -0.949528181,
  -0.956940336,
  -0.963776066,
  -0.970031253,
  -0.97570213,
  -0.98078528,
  -0.985277642,
  -0.98917651,
  -0.992479535,
  -0.995184727,
  -0.997290457,
  -0.998795456,
  -0.999698819,
  -1,
  -0.999698819,
  -0.998795456,
  -0.997290457,
  -0.995184727,
  -0.992479535,
  -0.98917651,
  -0.985277642,
  -0.98078528,
  -0.97570213,
  -0.970031253,
  -0.963776066,
  -0.956940336,
  -0.949528181,
  -0.941544065,
  -0.932992799,
  -0.923879533,
  -0.914209756,
  -0.903989293,
  -0.893224301,
  -0.881921264,
  -0.870086991,
  -0.85772861,
  -0.844853565,
  -0.831469612,
  -0.817584813,
  -0.803207531,
  -0.788346428,
  -0.773010453,
  -0.757208847,
  -0.740951125,
  -0.724247083,
  -0.707106781,
  -0.689540545,
  -0.671558955,
  -0.653172843,
  -0.634393284,
  -0.615231591,
  -0.595699304,
  -0.575808191,
  -0.555570233,
  -0.53499762,
  -0.514102744,
  -0.492898192,
  -0.471396737,
  -0.44961133,
  -0.427555093,
  -0.405241314,
  -0.382683432,
  -0.359895037,
  -0.336889853,
  -0.31368174,
  -0.290284677,
  -0.266712757,
  -0.24298018,
  -0.21910124,
  -0.195090322,
  -0.170961889,
  -0.146730474,
  -0.122410675,
  -0.09801714,
  -0.073564564,
  -0.049067674,
  -0.024541229
};
